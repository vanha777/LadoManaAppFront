import{bE as z,cL as _,cf as W,F as j,ac as e,aN as U,an as r,ae as o,b2 as N,ag as S,bY as H,b4 as F,ah as P,aD as A,aj as w,aR as k,bh as J,bi as $,bS as Q,cM as X,aM as b,bl as Y,cN as V,cO as G,bI as R,at as K,a9 as Z,b$ as I,cP as ee,ay as se,ab as te,ad as ae,ak as q,ax as E,al as ie}from"./index-kAVNsXXW.js";import{D as M}from"./DatePicker-Z7sQcGdH.js";import{C as ne}from"./Card-yNtnckip.js";const B=[{id:1,name:"full stack development",price:90.99},{id:2,name:"backend development",price:80.99},{id:3,name:"ui design",price:70.99},{id:4,name:"ui/ux design",price:60.99},{id:5,name:"front end development",price:40.99}];function le(){const{control:c,setValue:s,watch:x,resetField:l}=z(),{fields:d,append:a,remove:m}=_({control:c,name:"items"}),n=x(),u=n.items.map(t=>t.quantity*t.price),g=W(u)-n.discount+n.taxes;j.useEffect(()=>{s("totalPrice",g)},[s,g]);const f=()=>{a({title:"",description:"",service:"",quantity:1,price:0,total:0})},h=t=>{m(t)},y=j.useCallback(t=>{l(`items[${t}].quantity`),l(`items[${t}].price`),l(`items[${t}].total`)},[l]),v=j.useCallback((t,i)=>{var p;s(`items[${t}].price`,(p=B.find(D=>D.name===i))==null?void 0:p.price),s(`items[${t}].total`,n.items.map(D=>D.quantity*D.price)[t])},[s,n.items]),T=j.useCallback((t,i)=>{s(`items[${i}].quantity`,Number(t.target.value)),s(`items[${i}].total`,n.items.map(p=>p.quantity*p.price)[i])},[s,n.items]),C=j.useCallback((t,i)=>{s(`items[${i}].price`,Number(t.target.value)),s(`items[${i}].total`,n.items.map(p=>p.quantity*p.price)[i])},[s,n.items]);return e.jsxs(U,{sx:{p:3},children:[e.jsx(r,{variant:"h6",sx:{color:"text.disabled",mb:3},children:"Details:"}),e.jsx(o,{divider:e.jsx(N,{flexItem:!0,sx:{borderStyle:"dashed"}}),spacing:3,children:d.map((t,i)=>e.jsxs(o,{alignItems:"flex-end",spacing:1.5,children:[e.jsxs(o,{direction:{xs:"column",md:"row"},spacing:2,sx:{width:1},children:[e.jsx(S,{size:"small",name:`items[${i}].title`,label:"Title",InputLabelProps:{shrink:!0}}),e.jsx(S,{size:"small",name:`items[${i}].description`,label:"Description",InputLabelProps:{shrink:!0}}),e.jsxs(H,{name:`items[${i}].service`,size:"small",label:"Service",InputLabelProps:{shrink:!0},sx:{maxWidth:{md:160}},children:[e.jsx(F,{value:"",onClick:()=>y(i),sx:{fontStyle:"italic",color:"text.secondary"},children:"None"}),e.jsx(N,{}),B.map(p=>e.jsx(F,{value:p.name,onClick:()=>v(i,p.name),children:p.name},p.id))]}),e.jsx(S,{size:"small",type:"number",name:`items[${i}].quantity`,label:"Quantity",placeholder:"0",onChange:p=>T(p,i),InputLabelProps:{shrink:!0},sx:{maxWidth:{md:96}}}),e.jsx(S,{size:"small",type:"number",name:`items[${i}].price`,label:"Price",placeholder:"0",onChange:p=>C(p,i),InputProps:{startAdornment:e.jsx(P,{position:"start",children:"$"})},sx:{maxWidth:{md:96}}}),e.jsx(S,{disabled:!0,size:"small",name:`items[${i}].total`,label:"Total",placeholder:"0",value:u[i],InputProps:{startAdornment:e.jsx(P,{position:"start",children:"$"})},sx:{maxWidth:{md:96}}})]}),e.jsx(A,{size:"small",color:"error",startIcon:e.jsx(w,{icon:"eva:trash-2-outline"}),onClick:()=>h(i),children:"Remove"})]},t.id))}),e.jsx(N,{sx:{my:3,borderStyle:"dashed"}}),e.jsxs(o,{spacing:2,direction:{xs:"column-reverse",md:"row"},alignItems:{xs:"flex-start",md:"center"},children:[e.jsx(A,{size:"small",startIcon:e.jsx(w,{icon:"eva:plus-fill"}),onClick:f,sx:{flexShrink:0},children:"Add Item"}),e.jsxs(o,{spacing:2,justifyContent:"flex-end",direction:{xs:"column",md:"row"},sx:{width:1},children:[e.jsx(S,{size:"small",label:"Discount",name:"discount",onChange:t=>s("discount",Number(t.target.value)),sx:{maxWidth:{md:200}}}),e.jsx(S,{size:"small",label:"Taxes",name:"taxes",onChange:t=>s("taxes",Number(t.target.value)),sx:{maxWidth:{md:200}}})]})]}),e.jsxs(o,{spacing:2,sx:{mt:3},children:[e.jsxs(o,{direction:"row",justifyContent:"flex-end",children:[e.jsx(r,{children:"Subtotal :"}),e.jsx(r,{sx:{textAlign:"right",width:120},children:k(W(u))||"-"})]}),e.jsxs(o,{direction:"row",justifyContent:"flex-end",children:[e.jsx(r,{children:"Discount :"}),e.jsx(r,{sx:{textAlign:"right",width:120,...n.discount&&{color:"error.main"}},children:n.discount?`- ${k(n.discount)}`:"-"})]}),e.jsxs(o,{direction:"row",justifyContent:"flex-end",children:[e.jsx(r,{children:"Taxes :"}),e.jsx(r,{sx:{textAlign:"right",width:120},children:n.taxes?k(n.taxes):"-"})]}),e.jsxs(o,{direction:"row",justifyContent:"flex-end",children:[e.jsx(r,{variant:"h6",children:"Total price :"}),e.jsx(r,{variant:"h6",sx:{textAlign:"right",width:120},children:k(g)||"-"})]})]})]})}O.propTypes={open:b.bool,onClose:b.func,onSelect:b.func,selected:b.func,addressOptions:b.array};function O({open:c,selected:s,onClose:x,onSelect:l,addressOptions:d}){const[a,m]=j.useState(""),n=oe(d,a),u=!n.length&&!!a,g=h=>{m(h.target.value)},f=h=>{l(h),m(""),x()};return e.jsxs(J,{fullWidth:!0,maxWidth:"xs",open:c,onClose:x,children:[e.jsxs(o,{direction:"row",alignItems:"center",justifyContent:"space-between",sx:{pt:2.5,px:3},children:[e.jsx(r,{variant:"h6",children:" Select address "}),e.jsx(A,{size:"small",startIcon:e.jsx(w,{icon:"eva:plus-fill"}),sx:{alignSelf:"flex-end"},children:"Add New"})]}),e.jsx(o,{sx:{p:2.5},children:e.jsx($,{value:a,onChange:g,placeholder:"Search...",InputProps:{startAdornment:e.jsx(P,{position:"start",children:e.jsx(w,{icon:"eva:search-fill",sx:{color:"text.disabled"}})})}})}),u?e.jsx(Q,{query:a,sx:{px:3,pt:5,pb:10}}):e.jsx(o,{sx:{p:1.5,pt:0,maxHeight:80*8,overflowX:"hidden"},children:n.map(h=>e.jsxs(X,{selected:s(h.id),onClick:()=>f(h),sx:{p:1.5,borderRadius:1,flexDirection:"column",alignItems:"flex-start","&.Mui-selected":{bgcolor:"action.selected","&:hover":{bgcolor:"action.selected"}}},children:[e.jsx(r,{variant:"subtitle2",children:h.name}),e.jsx(r,{variant:"caption",component:"div",sx:{my:.5,color:"info.main",fontWeight:"fontWeightMedium"},children:h.company}),e.jsx(r,{variant:"body2",sx:{color:"text.secondary"},children:h.address})]},h.id))})]})}function oe(c,s){return s?c.filter(x=>x.name.toLowerCase().indexOf(s.toLowerCase())!==-1||x.company.toLowerCase().indexOf(s.toLowerCase())!==-1||x.address.toLowerCase().indexOf(s.toLowerCase())!==-1):c}function de(){var C;const{watch:c,setValue:s,formState:{errors:x}}=z(),l=Y("up","md"),d=c(),{invoiceFrom:a,invoiceTo:m}=d,[n,u]=j.useState(!1),[g,f]=j.useState(!1),h=()=>{u(!0)},y=()=>{u(!1)},v=()=>{f(!0)},T=()=>{f(!1)};return e.jsxs(o,{spacing:{xs:2,md:5},direction:{xs:"column",md:"row"},divider:e.jsx(N,{flexItem:!0,orientation:l?"vertical":"horizontal",sx:{borderStyle:"dashed"}}),sx:{p:3},children:[e.jsxs(o,{sx:{width:1},children:[e.jsxs(o,{direction:"row",alignItems:"center",justifyContent:"space-between",sx:{mb:1},children:[e.jsx(r,{variant:"h6",sx:{color:"text.disabled"},children:"From:"}),e.jsx(A,{size:"small",startIcon:e.jsx(w,{icon:"eva:edit-fill"}),onClick:h,children:"Change"}),e.jsx(O,{open:n,onClose:y,selected:t=>(a==null?void 0:a.id)===t,onSelect:t=>s("invoiceFrom",t),addressOptions:V})]}),e.jsx(L,{name:a.name,address:a.address,phone:a.phone})]}),e.jsxs(o,{sx:{width:1},children:[e.jsxs(o,{direction:"row",alignItems:"center",justifyContent:"space-between",sx:{mb:1},children:[e.jsx(r,{variant:"h6",sx:{color:"text.disabled"},children:"To:"}),e.jsx(A,{size:"small",startIcon:e.jsx(w,{icon:m?"eva:edit-fill":"eva:plus-fill"}),onClick:v,children:m?"Change":"Add"}),e.jsx(O,{open:g,onClose:T,selected:t=>(m==null?void 0:m.id)===t,onSelect:t=>s("invoiceTo",t),addressOptions:G})]}),m?e.jsx(L,{name:m.name,address:m.address,phone:m.phone}):e.jsx(r,{typography:"caption",sx:{color:"error.main"},children:(C=x.invoiceTo)==null?void 0:C.message})]})]})}L.propTypes={name:b.string,phone:b.string,address:b.string};function L({name:c,address:s,phone:x}){return e.jsxs(e.Fragment,{children:[e.jsx(r,{variant:"subtitle2",children:c}),e.jsx(r,{variant:"body2",sx:{mt:1,mb:.5},children:s}),e.jsxs(r,{variant:"body2",children:["Phone: ",x]})]})}const re=["paid","unpaid","overdue","draft"];function ce(){const{control:c,watch:s}=z(),x=s();return e.jsxs(o,{spacing:2,direction:{xs:"column",sm:"row"},sx:{p:3,bgcolor:"background.neutral"},children:[e.jsx(S,{disabled:!0,name:"invoiceNumber",label:"Invoice number",value:`INV-${x.invoiceNumber}`}),e.jsx(H,{fullWidth:!0,name:"status",label:"Status",InputLabelProps:{shrink:!0},children:re.map(l=>e.jsx(F,{value:l,children:l},l))}),e.jsx(R,{name:"createDate",control:c,render:({field:l,fieldState:{error:d}})=>e.jsx(M,{label:"Date create",value:l.value,onChange:a=>{l.onChange(a)},renderInput:a=>e.jsx($,{...a,fullWidth:!0,error:!!d,helperText:d==null?void 0:d.message})})}),e.jsx(R,{name:"dueDate",control:c,render:({field:l,fieldState:{error:d}})=>e.jsx(M,{label:"Due date",value:l.value,onChange:a=>{l.onChange(a)},renderInput:a=>e.jsx($,{...a,fullWidth:!0,error:!!d,helperText:d==null?void 0:d.message})})})]})}me.propTypes={isEdit:b.bool,currentInvoice:b.object};function me({isEdit:c,currentInvoice:s}){const x=K(),[l,d]=j.useState(!1),[a,m]=j.useState(!1),n=Z().shape({invoiceTo:I().required("Invoice to is required"),dueDate:ee().min(se("createDate"),"Due date must be later than create date")}),u=j.useMemo(()=>({invoiceNumber:(s==null?void 0:s.invoiceNumber)||"17099",createDate:(s==null?void 0:s.createDate)||new Date,dueDate:(s==null?void 0:s.dueDate)||null,taxes:(s==null?void 0:s.taxes)||0,status:(s==null?void 0:s.status)||"draft",discount:(s==null?void 0:s.discount)||0,invoiceFrom:(s==null?void 0:s.invoiceFrom)||V[0],invoiceTo:(s==null?void 0:s.invoiceTo)||null,items:(s==null?void 0:s.items)||[{title:"",description:"",service:"",quantity:1,price:0,total:0}],totalPrice:(s==null?void 0:s.totalPrice)||0}),[s]),g=te({resolver:ie(n),defaultValues:u}),{reset:f,handleSubmit:h,formState:{isSubmitting:y}}=g;j.useEffect(()=>{c&&s&&f(u),c||f(u)},[c,s]);const v=async C=>{d(!0);try{await new Promise(t=>setTimeout(t,500)),f(),d(!1),x(E.invoice.list),console.log("DATA",JSON.stringify(C,null,2))}catch(t){console.error(t),d(!1)}},T=async C=>{m(!0);try{await new Promise(t=>setTimeout(t,500)),f(),m(!1),x(E.invoice.list),console.log("DATA",JSON.stringify(C,null,2))}catch(t){console.error(t),m(!1)}};return e.jsxs(ae,{methods:g,children:[e.jsxs(ne,{children:[e.jsx(de,{}),e.jsx(ce,{}),e.jsx(le,{})]}),e.jsxs(o,{justifyContent:"flex-end",direction:"row",spacing:2,sx:{mt:3},children:[e.jsx(q,{color:"inherit",size:"large",variant:"contained",loading:l&&y,onClick:h(v),children:"Save as Draft"}),e.jsxs(q,{size:"large",variant:"contained",loading:a&&y,onClick:h(T),children:[c?"Update":"Create"," & Send"]})]})]})}export{me as I};
